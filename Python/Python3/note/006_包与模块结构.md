# python组织结构

python组织结构：包、模块(文件)、类(函数和变量)。

在Python中模块概念和C语言中的头文件以及Java中的包很类似，比如在Python中要调用sqrt函数，必须用import关键字引入math这个模块

---
## 1 包

文件夹中必须包含`__init__.py`才被认为是一个包，`__init__.py`本身也是一个模块，它的名字是包的名字。


当一个包被导入时，`__init__.py`会被自动运行。`__init__.py`的应用场景：

- 在`__init__.py`做一些包的初始化工作
- 指定使用*导入时，哪些模块可以被导入，使用`__all__ = ['模块名']`控制
- 当`__init__.py`没有内容时，
- 导入公共模块，比如p包中的init导入了sys模块，则导入p包的模块可以以`p.sys.变量名`形式使用sys中的变量
- 内置变量`__name__`变量的结果能够判断出，是直接执行的python脚本还是被引入执行的


---
##  2 导入

使用import导包，import只能导入模块。使用as操作可以对导入的模块重命名：
```python
import datetime
import string as s
```

导入模块的一部分，使用`from 模块 import 变量1, 变量2, 变量3`
```python
from datetime import  date
```

使用`*`可以导入模块所有内容
```python
from string import *
```

控制`*`导入的模块内容
```python
__all__ = ['a'] # 此时使用*导入该模块，只导入变量a
a = 3
b =4
```

当你导入一个模块，Python解析器对模块位置的搜索顺序是：
    - 当前- 目录
    - 如果不在当前目录，Python则搜索在shell变量`PYTHONPATH`下的每个目录。
    - 如果都找不到，Python会察看默认路径。UNIX下，默认路径一般为`/usr/local/lib/python/`
    - 模块搜索路径存储在system模块的sys.path变量中。变量里包含当前目录，`PYTHONPATH`和由安装过程决定的默认目录。

---
## 3 发布包

- 假设项目结构如下：
```
├── setup.py
├── suba
│   ├── aa.py
│   ├── bb.py
│   └── __init__.py
└── subb
    ├── cc.py
    ├── dd.py
    └── __init__.py
```

- 编辑setup.py文件

py_modules需指明所需包含的py文件：
```python
from distutils.core import setup

setup(name="dongGe", version="1.0", description="dongGe's module", author="dongGe", py_modules=['suba.aa', 'suba.bb', 'subb.cc', 'subb.dd'])
```

- 构建模块

执行`python setup.py build`，构建后目录结构：

```
├── build
│   └── lib.linux-i686-2.7
│       ├── suba
│       │   ├── aa.py
│       │   ├── bb.py
│       │   └── __init__.py
│       └── subb
│           ├── cc.py
│           ├── dd.py
│           └── __init__.py
├── setup.py
├── suba
│   ├── aa.py
│   ├── bb.py
│   └── __init__.py
└── subb
    ├── cc.py
    ├── dd.py
    └── __init__.py
```

- 生成发布压缩包

执行`python setup.py sdist`

---
## 4 模块安装、使用

安装的方式：
- 找到模块的压缩包
- 解压
- 进入文件夹
- 执行命令`python setup.py install`，或可以指定路径`python setup.py install --prefix=安装路径`

模块的引入：
- 在程序中，使用from import 即可完成对安装的模块使用

---
## 5 给程序传参

```python
import sys
#通过sys模块的argv可以获取程序启动时的入参   
print(sys.argv)
```

---
## 6 模块的导入路径

模块的path属性存储了模块导入时的搜索路径

```python
import sys
path = sys.path
# 添加导入模块的搜索路径，这样就可以导入对应路径下的模块了
sys.path.append("xxx") 
```

---
## 7 重新导入

一个模块只能被导入一次，当导入一个模块后，即使再次使用import也不会重新导入，如果模块被导入后发生了改变，那么无法使用到被导入模块新的功能，此时只能使用reload函数：
```python
import x
from imp import *
reload(x)
```


---
##   常见错误

- 包和模块不会被重复导入
- 避免循环导入
    - 程序设计上分层，降低耦合
    - 导入语句放在后面需要导入时再导入，例如放在函数体内导入
- 保证只有一个入口文件，每个模块被导入时其中的代码会被执行一次
