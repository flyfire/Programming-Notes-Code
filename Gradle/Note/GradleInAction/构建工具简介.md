# 1 项目自动化介绍

忍受零散编译的问题、构建不一致的软件工作和失败的部署是引入构建工具的原因。
有效的项目自动化是促使软件交付给终端用户的关键因素。

## 1.1 没有项目自动化的生活

简直就是噩梦，难道你要忍受自己去编译每一个代码文件的痛苦。

## 1.2 项目自动化的好处

- 防止手动介入：人总是容易犯错误
- 创建可重复的构建
- 让重构便携:一个自动化构建不应该依赖于特定的运行环境才能工作

## 1.3 项目自动化的类型

### 按需构建

典型的用例就是用户在自己的机器上触发构建

### 触发构建

比如在向版本控制系统中提交了新代码时触发构建，从而快速得到反馈

### 预定构建

预定构建时一种基于时间的程序调度方案


## 1.4 构建工具

### 什么是构建工具

可以编程的工具，它能够让你以**可执行和有序的**任务来表达自动化需求：

`编译源代码-->拷贝class文件到目录-->组装构建`

- 每一个任务都代表一个工作单元
- 顺序是非常重要的

由此构成一个**有向图**。

### 构建工具剖析

- **构建文件**：包含构建所需要的配置信息、定义外部依赖、以任务形式实习那某个特殊目的的指令或它们的相互依赖关系，构建文件也叫**构建脚本**
- **构建的输入和输出**：一个任务会接收一个输入，然后执行一系列步骤，最后产生一个输出(非必须)。
- **构建引擎**：构建文件的一步一步指令或者规则集必须被翻译成构建工具可以理解的**内部模型**，构建引擎会在构建期间处理构建脚本，解析任务之间的依赖关系。一旦内部模型建立好，引擎就会按照正确的顺序去执行一系列任务。
- **依赖管理**：用于处理在构建文件中声明的依赖，比如远程仓库的一个类库



## 1.5 Java构建工具

### [Apache Ant](http://ant.apache.org/)

Apache Ant(Another Neat Tool 另一个整洁的工具)是一个Java编写的构建工具

**特点**：
- 通过xml表示build文件
- Ant不提供依赖管理器(但可以与Ivy很好的集成，Ivy也是Apache的一个项目，用于依赖管理)

**构建的基本术语**：
一个构建有三个基本元素组成：

- 一个projcet Ant脚本的顶级元素，所有Ant项目都必需的容器，包含一个或多个target，一个构建脚本只能定义一个project
- 多个target  (想要执行的task的一个集合)
- 可用的task (一段可执行的代码)

**缺点**
- xml构建脚本会导致构建脚本过于臃肿和啰嗦
- 赋值的构建会导致有长有难以维护的构建脚本，定义if-then/if-then-else类似逻辑语句时一种负担
- Ant没有提供任何指导来告诉你如何健身项目
- 没有暴露任何api来获取内存模型中的信息
- 没有Ivy的情况下，使用Ant很难管理依赖


### [Apach Meven](https://maven.apache.org/)

Meven团队选择**约定优于配置的思想**，其为项目配置和行为提供了有意义的默认值。

- 引入默认的项目配置布局
- 构建生命周期
- 提供依赖管理，通过`组织名、工件名、版本`即可获取依赖
- Meven预配置从MavenCentral下载依赖，MavenCentral是Java社区最流行的二进制工件仓库

**缺点**：

- 默认的结构不具有扩展性，限制太多
- 定制扩展太过于累赘，需要学习Mojos


### 对下一代构建工具的需求

- 具有表达性、声明式、可维护的构建语言
- 标准化的项目布局和生命周期、但具有完全灵活性和对默认值完全可配置性
- 又有灵活易用的方式去实现定制逻辑
- 支持构建多个项目
- 支持依赖管理
- 能很好的集成和迁移现有的构建基础设施
- 抢到可扩展性和高效的构建。



<br/><br/><br/>

# 2 Gradle介绍

# 2.1 Gradle

Gradle是基于JVM构建工具的新一代版本，使用一种强大的且具有表达性的基于Groovy的领域特定语言(DSL)。

- 灵活性、完全控制、目标链
- 依赖管理
- 约定优于配置、多模块项目、插件扩展
- 在Ant基础上提供Groovy的DSL

Gradle座右铭：让不可能称为可能，让可能变得简单，让简单变得优雅。

**Gradle发展**：

- Spring2010会议上获得Springy大奖
- 2013年年Gradle被标记为采纳状态
- 现在几乎每个Android项目都采用Gradle构建

## 2.2 Gradle引入注目的特性集


1. 可表达性的构建语言与底层API
 - 一个构建脚本直接映射到GradleAPI中的Project类型的实例
 - 在Gradle中，每一个元素都有一个与Java类一对一的映射
 - Gradle的工作单元被描述为task
2. Gradle就是Groovy，Gradle的DSL使用Groovy实现
3. 灵活的约定
 - Gradle最主要的思想就是针对你的项目给予引导和有意义的默认值。而且改变这些默认值也很容易
 - Gradle中的每个Java项目都确切的指导源代码和测试类文件的位置。对于每个Java项目，Gradle已经提供了默认的有意义的任务
4. 鲁棒(Robust的音译，也就是健壮、强壮、坚定、粗野)和强大的依赖管理
 - Gradle提供了一个基础设施去管理解析、获取和存储依赖的复杂性
 - 依赖传递(外部依赖可能还存在对其他类库或资源的引用)
5. 可扩展的构建
 - Gradle可通过指定任务的输入和输出进行增量构建
 - 守护进程构建
6. 轻松的可扩展性
 - 插件
7. 和其它构建集成
 - ant
 - Maven
8. 社区和公司推动
 - Gradle基于Apache License2.0完全免费
 - 社区充满活力
 - 由Gradleware公司提供技术服务和支持
9. 锦上添花：额外的特性
 - Gradle包装器


## 2.3 从构建到部署自动化项目

持续交付引入了部署管道的概念，也叫构建管道，部署管道是一种将软件从版本控制部署到产品环境过程的技术试实现。

- 提交阶段
- 自动化测试验收测试阶段
- 手动测试阶段
- 发布阶段
