# 第十七章：应用编译时元编程.md


Groovy同时提供了运行时和编译时元编程

编译时元编程时一种高级特性，可以用于某些特殊情况，比如：框架或者工具的编写使用

借助Groovy可以在编译时**分析和修改**程序的结构，比如无需修改源代码，既可以为线程安全、日志消息和代码的不同部分执行前置和后置操作等、对类进行检查。


Groovy2中的类型检查器就实现了为一个抽象语法树(AST)变换，优雅的单元测试工具Spock使用这种范式来支持流畅的测试用例，还有代码检查工具CodeNarc。


## 1 在编译时分析代码

为方法和遍历取一个好名字并不是易事，但是只用一个字母来命名变量和方法显然时不对的，使用Groovy可以实现自动检查。
要检查代码异味、需要编译代码结构，分析类名、方法名、字段名、参数名等。Groovy允许我们进入其编译阶段、一窥其处理的
(AST)。AST树结构描述了程序中的表达式和语句，它是使用节点表示的，随着程序的进行其AST会被变换，包括节点插入、删除、重新排序。
在编译过程中我们可以随着AST的演进对其进行检查。

要使用编译时元编程，必须理解和使用AST，使用groovyConsole的inspect AST工具可以显示代码的AST。

示例`CodeCheck`


## 2 使用AST变换拦截方法调用
## 3 使用AST变换注入方法

略





<hr/>






